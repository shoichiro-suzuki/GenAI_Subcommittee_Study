# アーキテクチャ設計書

## 1. システム構成

### 1.1 レイヤー構造
```
┌─────────────────────────────┐
│   CLI Layer (main.py)       │  ← ユーザーインターフェース
├─────────────────────────────┤
│   Service Layer             │  ← ビジネスロジック
│   (todo_service.py)         │
├─────────────────────────────┤
│   Data Layer                │  ← データ永続化
│   (data_manager.py)         │
├─────────────────────────────┤
│   Model Layer               │  ← データモデル
│   (models.py)               │
└─────────────────────────────┘
         ↓
    todos.json
```

### 1.2 責務分離

| レイヤー | モジュール | 責務 |
|---------|----------|------|
| CLI | `main.py` | コマンド解析、入出力、エラー表示 |
| Service | `todo_service.py` | Todo操作ロジック、バリデーション |
| Data | `data_manager.py` | JSON読み書き、データ整合性管理 |
| Model | `models.py` | データクラス定義、型定義 |

## 2. ディレクトリ構造

```
GenAI_Subcommittee_Study/
├── docs/                          # ドキュメント
│   ├── 要件定義書.md
│   ├── データスキーマ定義書.md
│   ├── アーキテクチャ設計書.md
│   ├── CLI仕様書.md
│   └── 開発TODO.md
├── services/                      # サービス実装
│   ├── __init__.py
│   ├── models.py                 # データモデル
│   ├── data_manager.py           # データ管理
│   ├── todo_service.py           # Todoサービス
│   └── main.py                   # CLIエントリーポイント
├── tests/                        # テストコード
│   ├── __init__.py
│   ├── test_models.py
│   ├── test_data_manager.py
│   └── test_todo_service.py
├── build/                        # ビルド成果物（.gitignore対象）
├── dist/                         # 配布物（.gitignore対象）
├── CLAUDE.md                     # プロジェクト規約
├── README.md
├── requirements.txt              # Python依存パッケージ
└── build.spec                    # PyInstallerビルド設定
```

## 3. モジュール設計

### 3.1 models.py
```python
# データクラス定義
- Todo: Todoアイテムのデータクラス
- TodoDatabase: JSON全体のデータ構造
```

**主要クラス**:
- `Todo`: id, title, completed, created_at, updated_at
- `TodoDatabase`: version, todos, next_id

### 3.2 data_manager.py
```python
# JSON操作
- load_data(): JSONファイル読み込み
- save_data(): JSONファイル書き込み
- backup_data(): バックアップ作成
- init_data(): 初期データ生成
```

**主要機能**:
- ファイル存在確認
- JSON parse/stringify
- エラーハンドリング（破損検知、バックアップ）

### 3.3 todo_service.py
```python
# Todoビジネスロジック
- add_todo(title): Todo追加
- list_todos(): 全Todo取得
- toggle_todo(id): 完了状態切り替え
- delete_todo(id): Todo削除
```

**主要機能**:
- バリデーション（タイトル長、ID存在確認）
- ID自動採番
- 日時自動設定
- データ操作後の自動保存

### 3.4 main.py
```python
# CLIインターフェース
- parse_args(): コマンドライン引数解析
- display_todos(): Todo一覧の整形表示
- main(): エントリーポイント
```

**主要機能**:
- argparseによるコマンド解析
- ユーザー入力処理
- 結果表示（テーブル形式）
- エラーメッセージ表示

## 4. データフロー

### 4.1 Todo追加の流れ
```
ユーザー入力
  ↓
main.py (parse_args)
  ↓
todo_service.py (add_todo)
  ↓ バリデーション
  ↓ ID採番、日時設定
  ↓
data_manager.py (save_data)
  ↓
todos.json
```

### 4.2 起動時の初期化
```
main.py (起動)
  ↓
data_manager.py (load_data)
  ↓
todos.json 存在確認
  ├─ あり → 読み込み
  └─ なし → init_data() → 初期JSON生成
```

## 5. エラーハンドリング戦略

### 5.1 エラー分類
| エラー種別 | 処理方針 |
|----------|---------|
| ファイル不存在 | 自動生成（初回起動） |
| JSON破損 | バックアップ作成 → 初期化 |
| 不正なID指定 | エラーメッセージ表示 |
| バリデーション失敗 | エラーメッセージ表示 |

### 5.2 ログ戦略
- **標準出力**: 成功メッセージ、Todo一覧
- **標準エラー出力**: エラーメッセージ、警告
- **ログファイル**: なし（シンプル化のため）

## 6. 依存関係

### 6.1 外部ライブラリ
```
標準ライブラリのみ使用（外部依存なし）:
- argparse: コマンドライン解析
- json: JSON操作
- datetime: 日時処理
- dataclasses: データクラス
- pathlib: パス操作
- typing: 型ヒント
```

### 6.2 モジュール間依存
```
main.py
  ↓ import
todo_service.py
  ↓ import
data_manager.py
  ↓ import
models.py
```

**依存方向**: 上位レイヤーが下位レイヤーに依存（一方向）

## 7. ビルド構成

### 7.1 PyInstallerオプション
```bash
pyinstaller --onefile --name SimpleTodo services/main.py
```

**主要オプション**:
- `--onefile`: 単一EXEファイル生成
- `--name SimpleTodo`: 実行ファイル名
- `--noconsole`: なし（CLI表示のため）

### 7.2 配布物
```
SimpleTodo.exe  ← 実行ファイル
todos.json      ← データファイル（初回起動時に自動生成）
```

## 8. 拡張性考慮

### 8.1 機能追加の容易性
- **新規コマンド追加**: main.pyにsubparser追加
- **新規フィールド追加**: models.pyとdata_managerを更新
- **新規ビジネスロジック**: todo_service.pyにメソッド追加

### 8.2 バージョン管理
- `version`フィールドでスキーマバージョン管理
- 将来的なマイグレーション対応可能
