# データスキーマ定義書

## 1. ファイル仕様

### 1.1 基本情報
- **ファイル名**: `todos.json`
- **配置場所**: 実行ファイル（SimpleTodo.exe）と同ディレクトリ
- **エンコーディング**: UTF-8
- **形式**: JSON

## 2. データ構造

### 2.1 全体構造
```json
{
  "version": "1.0",
  "todos": [
    {
      "id": 1,
      "title": "タスク1",
      "completed": false,
      "created_at": "2025-01-15T10:30:00",
      "updated_at": "2025-01-15T10:30:00"
    }
  ],
  "next_id": 2
}
```

### 2.2 フィールド定義

#### ルートオブジェクト
| フィールド | 型 | 必須 | 説明 |
|----------|---|-----|------|
| `version` | string | ✓ | スキーマバージョン（現在: "1.0"） |
| `todos` | array | ✓ | Todoアイテムの配列 |
| `next_id` | integer | ✓ | 次に割り当てるID（自動採番用） |

#### Todoオブジェクト
| フィールド | 型 | 必須 | 説明 |
|----------|---|-----|------|
| `id` | integer | ✓ | 一意識別子（1から連番） |
| `title` | string | ✓ | タスクのタイトル（1〜200文字） |
| `completed` | boolean | ✓ | 完了状態（true: 完了、false: 未完了） |
| `created_at` | string | ✓ | 作成日時（ISO 8601形式） |
| `updated_at` | string | ✓ | 更新日時（ISO 8601形式） |

## 3. バリデーションルール

### 3.1 データ整合性
- `id`は正の整数
- `id`は`todos`配列内で一意
- `next_id`は最大ID値 + 1以上
- `title`は空文字列不可
- `title`は200文字以内
- 日時はISO 8601形式（`YYYY-MM-DDTHH:MM:SS`）

### 3.2 初期状態
```json
{
  "version": "1.0",
  "todos": [],
  "next_id": 1
}
```

## 4. 操作仕様

### 4.1 追加操作
1. `next_id`を新しいTodoの`id`に割り当て
2. `created_at`と`updated_at`に現在時刻を設定
3. `todos`配列に追加
4. `next_id`をインクリメント

### 4.2 更新操作
1. 対象TodoをIDで検索
2. 変更するフィールドを更新
3. `updated_at`を現在時刻に更新

### 4.3 削除操作
1. 対象TodoをIDで検索
2. `todos`配列から削除
3. `next_id`は変更しない（IDの再利用を防止）

## 5. エラーハンドリング

### 5.1 ファイル読み込みエラー
- **ファイル不存在**: 初期状態で自動生成
- **JSON形式エラー**: バックアップ作成後、初期状態で上書き
- **スキーマ不整合**: バックアップ作成後、初期状態で上書き

### 5.2 データ破損時の復旧
```
todos.json → todos.json.backup に退避
新規 todos.json を初期状態で生成
```

## 6. 将来拡張フィールド（予約）

以下のフィールドは将来実装時に追加可能：
- `priority`: 優先度（整数値）
- `due_date`: 期限（ISO 8601形式）
- `category`: カテゴリ（文字列）
- `tags`: タグ（文字列配列）
- `description`: 詳細説明（文字列）

## 7. バージョン管理

### 7.1 スキーマバージョン履歴
| バージョン | 変更内容 | 日付 |
|----------|---------|------|
| 1.0 | 初期スキーマ | 2025-01 |
